/*
 ============================================================================
 Name        : test.c
 Author      : 
 Version     :
 Copyright   : Your copyright notice
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#include <stdio.h>
#include <stdlib.h>

#include <math.h>
#include "test.h"


//测试转义字符
void buff_test(void)
{
	char json_buff[] = "{\"results\":[{\"location\":{\"id\":\"WX4FBXXFKE4F\",\"name\":\"Beijing\"},\"now\":{\"temperature\":\"18\"}}]}";

	char hello[] = "\"HelloWorld!\"";


	int size = sizeof(json_buff);
	printf("size = %d\n", size);

	size = sizeof(hello);
	printf("size = %d\n", size);
}


unsigned long long long_buff[64] =
{
		0x0000000000000001,
		0x0000000000000002,
		0x0000000000000004,
		0x0000000000000008,
		0x0000000000000010,
		0x0000000000000020,
		0x0000000000000040,
		0x0000000000000080,
		0x0000000000000100,
		0x0000000000000200,
		0x0000000000000400,
		0x0000000000000800,
		0x0000000000001000,
		0x0000000000002000,
		0x0000000000004000,
		0x0000000000008000,
		0x0000000000010000,
		0x0000000000020000,
		0x0000000000040000,
		0x0000000000080000,
		0x0000000000100000,
		0x0000000000200000,
		0x0000000000400000,
		0x0000000000800000,
		0x0000000001000000,
		0x0000000002000000,
		0x0000000004000000,
		0x0000000008000000,
		0x0000000010000000,
		0x0000000020000000,
		0x0000000040000000,
		0x0000000080000000,
		0x0000000100000000,
		0x0000000200000000,
		0x0000000400000000,
		0x0000000800000000,
		0x0000001000000000,
		0x0000002000000000,
		0x0000004000000000,
		0x0000008000000000,
		0x0000010000000000,
		0x0000020000000000,
		0x0000040000000000,
		0x0000080000000000,
		0x0000100000000000,
		0x0000200000000000,
		0x0000400000000000,
		0x0000800000000000,
		0x0001000000000000,
		0x0002000000000000,
		0x0004000000000000,
		0x0008000000000000,
		0x0010000000000000,
		0x0020000000000000,
		0x0040000000000000,
		0x0080000000000000,
		0x0100000000000000,
		0x0200000000000000,
		0x0400000000000000,
		0x0800000000000000,
		0x1000000000000000,
		0x2000000000000000,
		0x4000000000000000,
		0x8000000000000000,

};

void left_move(void)
{
	unsigned long long test_num64 = 1;

	unsigned int H;
	unsigned int L;

	for(int i=0; i<64; i++)
	{
		H = test_num64 >> 32;
		L = test_num64 & 0xffffffff;

		printf("%08x", H);
		printf("%08x\n", L);

		test_num64 = test_num64*2;
		//num_buff[i] = my_2_pow(i);
		//printf("%016x\n", num_buff[i]);
	}

	test_num64 = 0;
	test_num64 |= long_buff[60];

	H = test_num64 >> 32;
	L = test_num64 & 0xffffffff;

	printf("%08x", H);
	printf("%08x\n", L);

	test_num64 = 0xffffffffffffffff;
	test_num64 &= ~long_buff[63];

	H = test_num64 >> 32;
	L = test_num64 & 0xffffffff;

	printf("%08x", H);
	printf("%08x\n", L);

	printf("\n");
}



//flag == 0	//从小到大
//flag == 1	//从大到小

uint8_t float_sort_buff(float *buff, uint16_t size, uint8_t flag)
{
    int i, j = 0;
	float temp1 = 0;

    if(flag == 0)
    {
        for(j = 0; j < size - 1; j++)
        {
            for(i = 0; i < size - j - 1; i++)
            {
                if(buff[i] > buff[i + 1])
                {
                    temp1 = buff[i];
                    buff[i] = buff[i + 1];
                    buff[i + 1] = temp1;
                }
            }
        }
    }
    else if(flag == 1)
    {
        for(j = 0; j < size - 1; j++)
        {
            for(i = size - 2; i >= 0; i--)
            {
                if(buff[i] < buff[i + 1])
                {
                    temp1 = buff[i];
                    buff[i] = buff[i + 1];
                    buff[i + 1] = temp1;
                }
            }
        }
    }
	return 0;
}



//计算n秒内最大的偏移值
#define COG_BUF_SIZE    3
uint8_t is_out_max_diff(float *buf, uint8_t size, float new, float set_max_diff)
{
	uint8_t i=0;
	float left = 0;
	float right = 0;

	left = new-set_max_diff;
	right = new+set_max_diff;

	if(left<0)
	{
		left = 360+left;
	}
	if(right>360)
	{
		right = right-360;
	}

	printf("left = %f\n", left);
	printf("right = %f\n", right);

	for(i=0; i<size; i++)
	{
		if((buf[i]<left) && (buf[i]>right))
		{
			return 1;
		}
	}

	return 0;
}

uint8_t cal_data = 0;
void gps_test(void)
{
	float gps_cog[3] = {10, 350, 20};
	float gps_cog_new = 20.1;

	cal_data = is_out_max_diff(gps_cog, 3, gps_cog_new, 30);


	printf("%d\n", cal_data);

}


typedef struct
{
	int		a;
	char	b;
	char	c;
	float	d;
	char	e;
	double	f;

}PN_TYPE;

typedef struct
{
	char a;
	char b;
	double c;
	float g;
	PN_TYPE	pn;
	int i;
	char d;
	char e;
	float f;
	short h;


}TBOX_TYPE;
TBOX_TYPE tbox = {0};
void test_pn_size()
{
	int size_pn = sizeof(tbox.pn);
	printf("size_pn = %d\n", size_pn);
}


void test_priority_level()
{
	int a = 0x00;
	//if(a&0x04 == 0x04)--->if(a&(4 == 4))
	if((a&0x04) == 0x04)
	{
		printf("== > &");
	}
	else
	{
		printf("& > ==");
	}
}

int app_test(void)
{
	//left_move();

	//gps_test();
	//test_pn_size();
	test_priority_level();


	return EXIT_SUCCESS;
}


